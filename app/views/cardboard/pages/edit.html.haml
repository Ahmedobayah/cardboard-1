%h1 Page Edit

= simple_form_for @page, html: {class: "form-horizontal", :multipart => true} do |f|
  = f.error_notification
  = f.input :title

  = render "url_field", f: f

  = f.input :in_menu, label: false, inline_label: "Display in main menu?"

  = field_set_tag "SEO" do
    = f.simple_fields_for :meta_seo, OpenStruct.new(@page.seo) do |seo|
      - for key in [:title, :description, :keywords] | seo.object.methods(nil).grep(/[^=]$/)
        = seo.input key, required: false

  = field_set_tag "Fields" do  
    
    - for part in @page.parts #.rank(:part_position) don't rank, it prevents validations
      = f.simple_fields_for :parts, part do |g|

        = field_set_tag part.identifier.titleize do 

          - for subpart in part.subparts #.rank(:subpart_position)
            = g.simple_fields_for :subparts, subpart do |y|

              = render "subpart_fields", f: y, subpart: subpart
          
          - if part.repeatable?
            .links
              -# the "links" class is important for the cocoon gem
              = link_to_add_association "Add another #{part.identifier.singularize.titleize}", g, :subparts, :render_options => {:locals => {:subpart => part.new_subpart }}, class: "btn btn-block"

  .form-actions
    = f.button :submit, "Save", class:"btn-primary"
    = link_to "Cancel", dashboard_path, class:"btn"

